# .env

# Exchange API keys
BYBIT_API_KEY=4UOcv1FxRyiYOuxcLb
BYBIT_API_SECRET=wpf4l9uJcpFNnQBiEqJbB4kwhyqwKyfUy1Zy

# Exchange mode configuration
# BYBIT_TESTNET: Trading exchange (orders/positions/balance)
#   - true: Use testnet for safe order execution
#   - false: Use mainnet for real trading
BYBIT_TESTNET=true

# DATA_BYBIT_TESTNET: Data exchange (market data/OHLCV/orderbook)
#   - false: Use mainnet data (matches paper trading environment)
#   - true: Use testnet data
# Keep this false to ensure MC/EV calculations use real market data
DATA_BYBIT_TESTNET=false

# Trading settings
ENABLE_LIVE_ORDERS=false
MAX_NOTIONAL_EXPOSURE=10.0
MAX_CONCURRENT_POSITIONS=5
MAX_LEVERAGE=10
PAPER_EXIT_POLICY_MIN_HOLD_SEC=30
EXPOSURE_CAP_ENABLED=true
MAX_INFLIGHT_REQ=10
PAPER_EXIT_POLICY_DD_STOP_ROE=-0.01
HARD_STOP_LOSS_FRAC=0.010
DEFAULT_SIZE_FRAC=0.05

# Rebalancing settings
PAPER_ECONOMIC_BRAIN=true
# PAPER_REBALANCE_MIN_CAP_DIFF: Minimum % difference in target vs current weight to trigger rebalance (e.g., 0.25 = 25%)
PAPER_REBALANCE_MIN_CAP_DIFF=0.05
# PAPER_REBALANCE_INTERVAL_MS: Minimum interval between rebalancing execution checks (60 seconds)
PAPER_REBALANCE_INTERVAL_MS=60000
# REBALANCE_TARGET_EMA_ALPHA: EMA factor for smoothing Kelly target weights (lower = smoother/slower)
REBALANCE_TARGET_EMA_ALPHA=0.1

# Risk management settings
# HARD_STOP_LOSS_FRAC: 하드캡 기본값 (새 설정이 없으면 PRICE/ROE 둘 다에 사용)
# HARD_STOP_LOSS_PRICE_FRAC: 진입가 대비 가격변동 하드캡 (unlevered)
# HARD_STOP_LOSS_ROE_FRAC: 포지션 ROE(=PnL/Margin, levered) 하드캡
HARD_STOP_LOSS_FRAC=0.01
HARD_STOP_LOSS_ROE_FRAC=0.01

# Live trading robust settings
LIVE_ORDER_PENDING_MS=60000
LOG_LIVE_SYNC_WARN_INTERVAL_SEC=60

# Live state persistence (optional, for exchange API failure recovery)
# LIVE_STATE_PERSIST_ENABLED: Enable saving live mode state to disk (default: false)
#   - Useful as fallback when exchange API is unreachable during engine restart
#   - Live state files: state/live_balance, state/live_trade_tape.json, state/live_equity.json
# LIVE_STATE_PERSIST_INTERVAL_SEC: How often to save live state (default: 60 seconds)
LIVE_STATE_PERSIST_ENABLED=false
LIVE_STATE_PERSIST_INTERVAL_SEC=60

# Trading mode
SCORE_ONLY_MODE=false

# Data settings
CONSENSUS_THRESHOLD=0.0005
# 기존 paper trading에서 사용하던 전체 종목을 명시하면,
# Bybit testnet에 존재하는 심볼만 엔진 시작 시 자동 필터링되어 포함됩니다.
SYMBOLS_CSV=BTC/USDT:USDT,ETH/USDT:USDT,SOL/USDT:USDT,BNB/USDT:USDT,XRP/USDT:USDT,ADA/USDT:USDT,DOGE/USDT:USDT,DOT/USDT:USDT,NEAR/USDT:USDT,UNI/USDT:USDT,APT/USDT:USDT,SUI/USDT:USDT,SAND/USDT:USDT,LDO/USDT:USDT,CRV/USDT:USDT,HBAR/USDT:USDT,ICP/USDT:USDT,GMT/USDT:USDT
SPREAD_PAIRS=BTC/USDT:USDT,ETH/USDT:USDT;SOL/USDT:USDT,BNB/USDT:USDT
SPREAD_ENABLED=true
SPREAD_ENTRY_MAX=0.0005

# Decision settings
DECISION_REFRESH_SEC=30.0
DECISION_MAX_INFLIGHT=5
MAX_RETRY=3
RETRY_BASE_SEC=1.0
LOG_STDOUT=true

# OHLCV settings
OHLCV_SLEEP_SEC=10.0
OHLCV_PRELOAD_LIMIT=240
OHLCV_REFRESH_LIMIT=2

# Orderbook settings
ORDERBOOK_SLEEP_SEC=10.0

# Risk settings
EV_ENTRY_THRESHOLD=0.002
EV_EXIT_FLOOR_BULL=-0.0003
EV_EXIT_FLOOR_BEAR=-0.0003
EV_EXIT_FLOOR_CHOP=-0.0002
EV_EXIT_FLOOR_VOLATILE=-0.0002

# Alpha Calculation Improvements (2026-01-06)
# Scaling factor for mu_alpha (목표 범위로 재조정)
ALPHA_SCALING_FACTOR=100.0

# Score entry threshold (일관성 있는 score 기준)
SCORE_ENTRY_THRESHOLD=0.0003
SCORE_ENTRY_FLOOR=0.00015
SCORE_EXIT_THRESHOLD=0.00015
SCORE_EXTEND_MULT=1.2
SCORE_TIME_DECAY_K=0.6

# 5m TP-hit 기반 진입 게이트
SCORE_TP_ENTRY_MIN=0.06
SCORE_TP_ENTRY_HARD=0.02
SCORE_TP_ENTRY_GATE_MULT=2.5
SCORE_TP_ENTRY_HORIZON_SEC=300

# OHLCV preload limit (긴 윈도우 지원: 8시간 데이터 확보)
OHLCV_PRELOAD_LIMIT=500

# OFI scale (OFI 신호 과대평가 완화)
MU_OFI_SCALE=50.0
MC_VERBOSE_PRINT=true

# ========================================
# 실시간 시장 대응 강화 (2026-01-07)
# ========================================

# 1. OFI 강화 (호가창 압력 반영)
MU_OFI_SCALE=200.0
MU_ALPHA_W_MOM_BASE=0.30
MU_ALPHA_W_MOM_MIN=0.20
MU_ALPHA_W_MOM_MAX=0.60

# 2. 반응속도 개선
MU_MOM_TAU_FLOOR_SEC=900.0
MU_ALPHA_CHOP_WINDOW_BARS=30
MU_ALPHA_VOL_SHORT_BARS=15

# 3. Floor 완화
MU_ALPHA_FLOOR=-5.0

# 4. 최근 신호 강화 (NAPV 계산 시)
MU_ALPHA_EMA_ALPHA=0.3

# 5. Economic Brain 민감도 증가
PAPER_ECONOMIC_SWITCH_BUFFER=0.0001


# Monte Carlo simulation settings
MC_N_PATHS_LIVE=16384
